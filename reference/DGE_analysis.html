<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Perform differential expression analysis across cell types based on single cell data with Pseudobulk approach. Returns the results of this differential expression analysis — DGE_analysis • poweranalysis</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Perform differential expression analysis across cell types based on single cell data with Pseudobulk approach. Returns the results of this differential expression analysis — DGE_analysis"><meta property="og:description" content="Perform differential expression analysis across cell types based on single cell data with Pseudobulk approach. Returns the results of this differential expression analysis"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">poweranalysis</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/poweranalysis.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/getting_started.html">Getting Started</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/neurogenomics/Power_Analysis_package/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Perform differential expression analysis across cell types based on single cell data with Pseudobulk approach. Returns the results of this differential expression analysis</h1>
    <small class="dont-index">Source: <a href="https://github.com/neurogenomics/Power_Analysis_package/blob/migrate-rworkflows/R/DGE_analysis.R" class="external-link"><code>R/DGE_analysis.R</code></a></small>
    <div class="hidden name"><code>DGE_analysis.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Perform differential expression analysis across cell types based on single cell data with Pseudobulk approach. Returns the results of this differential expression analysis</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">DGE_analysis</span><span class="op">(</span></span>
<span>  <span class="va">SCE</span>,</span>
<span>  <span class="va">design</span>,</span>
<span>  <span class="va">pseudobulk_ID</span>,</span>
<span>  <span class="va">celltype_ID</span>,</span>
<span>  y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  region <span class="op">=</span> <span class="st">"single_region"</span>,</span>
<span>  coef <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  control <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pval_adjust_method <span class="op">=</span> <span class="st">"BH"</span>,</span>
<span>  adj_pval <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  folder <span class="op">=</span> <span class="st">"sc.cell.type.de.graphs/"</span>,</span>
<span>  rmv_zero_count_genes <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">F</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-sce">SCE<a class="anchor" aria-label="anchor" href="#arg-sce"></a></dt>
<dd><p>SingleCellExperiment object, a specialised S4 class for storing data from single-cell experiments. A location of an R, rds or qs file to be loaded can also be passed. If using R objects make sure SCE object saved with the name SCE</p></dd>


<dt id="arg-design">design<a class="anchor" aria-label="anchor" href="#arg-design"></a></dt>
<dd><p>Design formula of class type <code>formula</code>. Equation used to fit the model- data for the generalised linear model e.g. expression ~ sex + pmi + disease.</p></dd>


<dt id="arg-pseudobulk-id">pseudobulk_ID<a class="anchor" aria-label="anchor" href="#arg-pseudobulk-id"></a></dt>
<dd><p>Column name in the SCE object to perform pseudobulk on, usually the patient identifier. This column is used for grouping in the pseudobulk approach</p></dd>


<dt id="arg-celltype-id">celltype_ID<a class="anchor" aria-label="anchor" href="#arg-celltype-id"></a></dt>
<dd><p>Column name in the SCE object for the cell type variable. This is used to identify celltype specific DEGs. If there is only one cell type in the analysis, the analysis will be automatically updated accordingly.</p></dd>


<dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>Column name in the SCE object for the return variable e.g. "diagnosis" - Case or disease. Default is the last variable in the design formula. y can be discrete (logisitc regression) or continuous (linear regression)</p></dd>


<dt id="arg-region">region<a class="anchor" aria-label="anchor" href="#arg-region"></a></dt>
<dd><p>Column name in the SCE object for the study region. If there are multiple regions in the study (for example two brain regions). Pseudobulk values can be derived separately. Default is "single_region" which will not split by region.</p></dd>


<dt id="arg-coef">coef<a class="anchor" aria-label="anchor" href="#arg-coef"></a></dt>
<dd><p>Character specifying which level to investigate for the differential expression analysis e.g. in a case/control study use "case" if case is the identifier in the y column to get positive fold changes to relate to case samples. leave as default value for continuous y. Default is NULL.</p></dd>


<dt id="arg-control">control<a class="anchor" aria-label="anchor" href="#arg-control"></a></dt>
<dd><p>Character specifying which control level for the differential expression analysis e.g. in a case/control/other study use "control" in the y column to compare against. NOTE only need to specify if more than two groups in y, leave as default value for two groups or continuous y. Default is NULL.</p></dd>


<dt id="arg-pval-adjust-method">pval_adjust_method<a class="anchor" aria-label="anchor" href="#arg-pval-adjust-method"></a></dt>
<dd><p>Adjustment method for the p-value in the differential expression analysis. Default is benjamini hochberg "BH". See  stats::p.adjust for available options</p></dd>


<dt id="arg-adj-pval">adj_pval<a class="anchor" aria-label="anchor" href="#arg-adj-pval"></a></dt>
<dd><p>Adjusted p-value cut-off for the differential expression analysis, 0-1 range</p></dd>


<dt id="arg-folder">folder<a class="anchor" aria-label="anchor" href="#arg-folder"></a></dt>
<dd><p>Folder where the graphs from the differential expression analysis are saved. Default will create a folder in the current working directory "sc.cell.type.de.graphs". False will skip plotting.</p></dd>


<dt id="arg-rmv-zero-count-genes">rmv_zero_count_genes<a class="anchor" aria-label="anchor" href="#arg-rmv-zero-count-genes"></a></dt>
<dd><p>Whether genes with no count values in any cell should be removed. Default is TRUE</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical indicating if extra information about the differential expression analysis should be printed</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A list containing:
celltype_DEGs: list with the differentially expressed genes (DEGs) for each cell type
celltype_all_genes: list with all genes along with their differential expression scores for each cell type
celltype_counts: vector with the counts of cells after QC in each cell type</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># To use the function input the formula of the comparison you want to make along with the names</span></span></span>
<span class="r-in"><span><span class="co"># of the pseudobulk ID and celltype ID</span></span></span>
<span class="r-in"><span><span class="co"># If you want to compare disease and control across cell types, taking into account sex use:</span></span></span>
<span class="r-in"><span><span class="co">#  formula = ~ sex + disease. Firstly load  your SCE object (can otherwise specify location)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/qsbase/qs" class="external-link">qs</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SingleCellExperiment</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">SCE</span> <span class="op">&lt;-</span> <span class="fu">qs</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/qs/man/qread.html" class="external-link">qread</a></span><span class="op">(</span><span class="st">"sce.qs"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sc.cell.type.de.return_incl_sex</span><span class="op">&lt;-</span> <span class="fu">sc.cell.type.de</span><span class="op">(</span><span class="va">SCE_small</span>,</span></span>
<span class="r-in"><span>design<span class="op">=</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">pathological_diagnosis_original</span>,</span></span>
<span class="r-in"><span>pseudobulk_ID<span class="op">=</span><span class="st">"sample_id"</span>, celltype_ID<span class="op">=</span><span class="st">"allan_celltype"</span>,coef<span class="op">=</span><span class="st">"AD"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># If you only want to also account for other variables as well as sex, such as</span></span></span>
<span class="r-in"><span><span class="co"># postmortem interval (PMI):</span></span></span>
<span class="r-in"><span><span class="va">sc.cell.type.de.return_sex_pmi</span><span class="op">&lt;-</span> <span class="fu">sc.cell.type.de</span><span class="op">(</span><span class="va">SCE_small</span>,</span></span>
<span class="r-in"><span>design<span class="op">=</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">PMI</span> <span class="op">+</span> <span class="va">pathological_diagnosis_original</span>,</span></span>
<span class="r-in"><span>pseudobulk_ID<span class="op">=</span><span class="st">"sample_id"</span>, celltype_ID<span class="op">=</span><span class="st">"allan_celltype"</span>,coef<span class="op">=</span><span class="st">"AD"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># If you only want to compare disease and control across cell types w/o any other constraints:</span></span></span>
<span class="r-in"><span><span class="va">sc.cell.type.de.return</span><span class="op">&lt;-</span> <span class="fu">sc.cell.type.de</span><span class="op">(</span><span class="va">SCE_small</span>,design<span class="op">=</span> <span class="op">~</span> <span class="va">pathological_diagnosis_original</span>,</span></span>
<span class="r-in"><span>pseudobulk_ID<span class="op">=</span><span class="st">"sample_id"</span>, celltype_ID<span class="op">=</span><span class="st">"allan_celltype"</span>,coef<span class="op">=</span><span class="st">"AD"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># A good way to validate the DEG analysis approach is to run a sex comparison</span></span></span>
<span class="r-in"><span><span class="co"># You would expect genes on the sex chromosomes to be DEGs, this can be done:</span></span></span>
<span class="r-in"><span><span class="va">sc.cell.type.de.sex.return</span><span class="op">&lt;-</span> <span class="fu">sc.cell.type.de</span><span class="op">(</span><span class="va">SCE</span>,design<span class="op">=</span> <span class="op">~</span> <span class="va">sex</span>,</span></span>
<span class="r-in"><span>pseudobulk_ID<span class="op">=</span><span class="st">"sample_id"</span>, celltype_ID<span class="op">=</span><span class="st">"allan_celltype"</span>,coef<span class="op">=</span><span class="st">"M"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#get gene names of chromosomal DEGs</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/grimbough/biomaRt" class="external-link">'biomaRt'</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mart</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/biomaRt/man/useDataset.html" class="external-link">useDataset</a></span><span class="op">(</span><span class="st">"hsapiens_gene_ensembl"</span>, <span class="fu"><a href="https://rdrr.io/pkg/biomaRt/man/useMart.html" class="external-link">useMart</a></span><span class="op">(</span><span class="st">"ensembl"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">our_degs</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">gene_IDs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/biomaRt/man/getBM.html" class="external-link">getBM</a></span><span class="op">(</span>filters<span class="op">=</span> <span class="st">"ensembl_gene_id"</span>,</span></span>
<span class="r-in"><span>                  attributes<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ensembl_gene_id"</span>,<span class="st">"chromosome_name"</span>,<span class="st">"hgnc_symbol"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  values <span class="op">=</span> <span class="va">genes</span>, mart<span class="op">=</span> <span class="va">mart</span>,useCache <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">gene_IDs</span> <span class="op">&lt;-</span> <span class="fu">as.data.table</span><span class="op">(</span><span class="va">gene_IDs</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">setnames</span><span class="op">(</span><span class="va">gene_IDs</span>,<span class="st">"ensembl_gene_id"</span>,<span class="st">"name"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">DEGs</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="va">sc.cell.type.de.return</span><span class="op">$</span><span class="va">celltype_DEGs</span>,idcol<span class="op">=</span><span class="st">"celltype"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">setkey</span><span class="op">(</span><span class="va">DEGs</span>,<span class="va">name</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#append gene names</span></span></span>
<span class="r-in"><span><span class="va">DEGs</span><span class="op">[</span>, <span class="va">gene_name</span> <span class="op">:=</span> <span class="va">gene_IDs</span><span class="op">[</span><span class="va">DEGs</span>, on<span class="op">=</span><span class="fu">.</span><span class="op">(</span><span class="va">name</span><span class="op">)</span>, <span class="va">x.hgnc_symbol</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">DEGs</span><span class="op">[</span>, <span class="va">chromosome_name</span> <span class="op">:=</span> <span class="va">gene_IDs</span><span class="op">[</span><span class="va">DEGs</span>, on<span class="op">=</span><span class="fu">.</span><span class="op">(</span><span class="va">name</span><span class="op">)</span>, <span class="va">x.chromosome_name</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="co">#Xist should be there, key indicator of correct DEG analysis</span></span></span>
<span class="r-in"><span><span class="va">DEGs</span><span class="op">[</span><span class="va">gene_name</span><span class="op">==</span><span class="st">"XIST"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"celltype"</span>,<span class="st">"adj_pval"</span>,<span class="st">"lfc"</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="co">#Present in all cell types</span></span></span>
<span class="r-in"><span><span class="co"># There should also be high number of other DEGs on sex chromosomes, check:</span></span></span>
<span class="r-in"><span><span class="va">our_degs</span><span class="op">[</span><span class="va">chromosome_name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>,<span class="st">"Y"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>         <span class="va">.N</span>,by<span class="op">=</span><span class="fu">.</span><span class="op">(</span><span class="va">celltype</span>,<span class="va">chromosome_name</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Salman Fawad, Yunning Yuan.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

