<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Perform robust power analysis for differential gene expression in scRNA-seq dataset — power_analysis • poweranalysis</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Perform robust power analysis for differential gene expression in scRNA-seq dataset — power_analysis"><meta property="og:description" content="Run the complete power analysis pipeline by downsampling individuals and cells, performing differential expression analysis, and generating power plots."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">poweranalysis</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/bulk_analysis.html">Bulk Analysis</a>
    </li>
    <li>
      <a href="../articles/correlation_analysis.html">Correlation Analysis</a>
    </li>
    <li>
      <a href="../articles/power_analysis.html">Get Started</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/neurogenomics/Power_Analysis_package/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Perform robust power analysis for differential gene expression in scRNA-seq dataset</h1>
    <small class="dont-index">Source: <a href="https://github.com/neurogenomics/Power_Analysis_package/blob/docu-Yunning/R/power_analysis.r" class="external-link"><code>R/power_analysis.r</code></a></small>
    <div class="hidden name"><code>power_analysis.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Run the complete power analysis pipeline by downsampling individuals and cells, performing differential expression analysis, and generating power plots.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">power_analysis</span><span class="op">(</span></span>
<span>  <span class="va">SCE</span>,</span>
<span>  range_downsampled_individuals <span class="op">=</span> <span class="st">"placeholder"</span>,</span>
<span>  range_downsampled_cells <span class="op">=</span> <span class="st">"placeholder"</span>,</span>
<span>  output_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  sampleID <span class="op">=</span> <span class="st">"donor_id"</span>,</span>
<span>  design <span class="op">=</span> <span class="st">"placeholder"</span>,</span>
<span>  sexID <span class="op">=</span> <span class="st">"sex"</span>,</span>
<span>  celltypeID <span class="op">=</span> <span class="st">"cell_type"</span>,</span>
<span>  coeff <span class="op">=</span> <span class="st">"male"</span>,</span>
<span>  fdr <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  nom_pval <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  Nperms <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  region <span class="op">=</span> <span class="st">"single_region"</span>,</span>
<span>  control <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pval_adjust_method <span class="op">=</span> <span class="st">"BH"</span>,</span>
<span>  rmv_zero_count_genes <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-sce">SCE<a class="anchor" aria-label="anchor" href="#arg-sce"></a></dt>
<dd><p>A <code>SingleCellExperiment</code> object containing the input scRNA-seq data. You may also provide a path to an <code>.R</code>, <code>.rds</code>, or <code>.qs</code> file. If using a file, ensure the <code>SCE</code> object inside is named <code>SCE</code>.</p></dd>


<dt id="arg-range-downsampled-individuals">range_downsampled_individuals<a class="anchor" aria-label="anchor" href="#arg-range-downsampled-individuals"></a></dt>
<dd><p>A numeric vector specifying the number of individuals to include at each downsampling level, in ascending order (e.g., c(10, 20, 30)). By default, 12 evenly spaced values are generated from 0 to the total number of samples, each rounded up to the nearest multiple of 5.</p></dd>


<dt id="arg-range-downsampled-cells">range_downsampled_cells<a class="anchor" aria-label="anchor" href="#arg-range-downsampled-cells"></a></dt>
<dd><p>A numeric vector specifying the number of cells per individual to include at each downsampling level, in ascending order (e.g., c(20, 40, 60)). By default, 11 evenly spaced values are generated from 0 to the 90th percentile of per-individual cell counts, each rounded to the nearest multiple of 5.</p></dd>


<dt id="arg-output-path">output_path<a class="anchor" aria-label="anchor" href="#arg-output-path"></a></dt>
<dd><p>A directory path where DGE analysis outputs of down-sampled datasets and power plots will be saved.</p></dd>


<dt id="arg-sampleid">sampleID<a class="anchor" aria-label="anchor" href="#arg-sampleid"></a></dt>
<dd><p>Name of the column in the <code>SCE</code> metadata that identifies biological replicates (e.g., patient ID). This column is used for grouping in the pseudobulk approach.</p></dd>


<dt id="arg-design">design<a class="anchor" aria-label="anchor" href="#arg-design"></a></dt>
<dd><p>A model formula specifying covariates for differential expression analysis. It should be of class <code>formula</code> (e.g., <code>~ sex + pmi + disease</code>). This formula is used to fit a generalized linear model.</p></dd>


<dt id="arg-sexid">sexID<a class="anchor" aria-label="anchor" href="#arg-sexid"></a></dt>
<dd><p>Name of the column in the <code>SCE</code> metadata that encodes the sex of individuals. Default is <code>"sex"</code>.</p></dd>


<dt id="arg-celltypeid">celltypeID<a class="anchor" aria-label="anchor" href="#arg-celltypeid"></a></dt>
<dd><p>Name of the column in the <code>SCE</code> metadata indicating cell type labels. This is used to identify celltype specific DEGs.</p></dd>


<dt id="arg-coeff">coeff<a class="anchor" aria-label="anchor" href="#arg-coeff"></a></dt>
<dd><p>Character string indicating the level of the response variable (<code>y</code>) to test for in differential expression. For case-control studies, this would typically be "case" (e.g. "AD"). Typically used in binary comparisons. Not required for continuous outcomes.</p></dd>


<dt id="arg-fdr">fdr<a class="anchor" aria-label="anchor" href="#arg-fdr"></a></dt>
<dd><p>Adjusted p-value (False Discovery Rate) threshold for selecting significantly differentially expressed genes (DEGs). Only genes with adjusted p-values below this value will be retained. Default is 0.05.</p></dd>


<dt id="arg-nom-pval">nom_pval<a class="anchor" aria-label="anchor" href="#arg-nom-pval"></a></dt>
<dd><p>Nominal (unadjusted) p-value threshold for selecting DEGs. Used as an alternative to FDR when preferred. Only genes with p-values below this cutoff will be retained. Default is 0.05.</p></dd>


<dt id="arg-nperms">Nperms<a class="anchor" aria-label="anchor" href="#arg-nperms"></a></dt>
<dd><p>Number of subsets (permutations) to generate at each downsampling level during power analysis. Each subset is analyzed independently to estimate variability. Default is 20.</p></dd>


<dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>Name of the column in the <code>SCE</code> metadata representing the response variable (e.g., "diagnosis" - case or disease). If not specified, defaults to the last variable in the <code>design</code> formula. Accepts both categorical (logistic regression) and continuous (linear regression) variables.</p></dd>


<dt id="arg-region">region<a class="anchor" aria-label="anchor" href="#arg-region"></a></dt>
<dd><p>Optional column in <code>SCE</code> metadata indicating the tissue or brain region. If present, differential expression is performed within each region separately. Defaults to "single_region" (i.e., no regional split).</p></dd>


<dt id="arg-control">control<a class="anchor" aria-label="anchor" href="#arg-control"></a></dt>
<dd><p>Optional. Character string specifying the control level in the response variable (<code>y</code>) to compare against. Only required if <code>y</code> contains more than two levels. Ignored for binary or continuous outcomes.</p></dd>


<dt id="arg-pval-adjust-method">pval_adjust_method<a class="anchor" aria-label="anchor" href="#arg-pval-adjust-method"></a></dt>
<dd><p>Method used to adjust p-values for multiple testing. Default is "BH" (Benjamini–Hochberg). See <code><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">stats::p.adjust</a></code> for available options.</p></dd>


<dt id="arg-rmv-zero-count-genes">rmv_zero_count_genes<a class="anchor" aria-label="anchor" href="#arg-rmv-zero-count-genes"></a></dt>
<dd><p>Logical. Whether to remove genes with zero counts across all cells. Default is <code>TRUE</code>.
Saves all plots and DGE analysis outputs in the appropriate directories</p></dd>

</dl></div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Too slow to run with check()</span></span></span>
<span class="r-in"><span><span class="co"># 1. Prepare SCE</span></span></span>
<span class="r-in"><span><span class="va">micro_tsai</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Tsai_Micro.qs"</span>, package<span class="op">=</span><span class="st">"poweranalysis"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">SCE_tsai</span> <span class="op">&lt;-</span> <span class="fu">qs</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/qs/man/qread.html" class="external-link">qread</a></span><span class="op">(</span><span class="va">micro_tsai</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 2. Run Power Analysis</span></span></span>
<span class="r-in"><span><span class="va">PA_tsai</span> <span class="op">&lt;-</span> <span class="fu">poweranalysis</span><span class="fu">::</span><span class="fu">power_analysis</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">SCE_tsai</span>,</span></span>
<span class="r-in"><span>    sampleID <span class="op">=</span> <span class="st">"sample_id"</span>,</span></span>
<span class="r-in"><span>    celltypeID <span class="op">=</span> <span class="st">"cluster_celltype"</span>,</span></span>
<span class="r-in"><span>    design <span class="op">=</span> <span class="op">~</span> <span class="va">sex</span>,</span></span>
<span class="r-in"><span>    coef <span class="op">=</span> <span class="st">"M"</span>,</span></span>
<span class="r-in"><span>    output_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">PA_tsai</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Salman Fawad, Alan Murphy, Yunning Yuan, Nathan Skene.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer></div>






  </body></html>

